{% load static %}
{% load components %}
{% load profile_components %}
{% load models_components %}

<hr style="margin-top: 0.5rem;">
<div class="list-group font-golos">
  <div class="list-group-item row list-group-item-action align-items-start model-item">
    <div class="col-1">
      <p class="mb-1 fw-bold id">ID</p>
    </div>
    <div class="col-1" style="padding-left: 0;">
      <p class="mb-1 fw-bold lang">Lang</p>
    </div>
    <div class="col-4">
      <p class="mb-1 fw-bold name">Name</p>
    </div>
    <div class="col-2">
      <p class="mb-1 fw-bold author">Author name</p>
    </div>
    <div class="col-2">
      <p class="mb-1 fw-bold repository">Repository</p>
    </div>
    <div class="col-3 badge-container">
      <span class="badge created-date bg-primary rounded-pill">Created</span>
      <span class="badge type bg-primary rounded-pill">Type</span>
    </div>
    <div class="col-10" style="padding-left: 10px;">
      <p class="mb-1 fw-bold description" style="text-align:center;margin-top:-10px;">Description</p>
    </div>
  </div>
  {% for model in models %}
  <div class="list-group-item row list-group-item-action align-items-start model-item">
    <div class="col-1">
      <p class="mb-1 id">{{ model.id }}</p>
    </div>
    <div class="col-1" style="padding-left: 0;">
      {% with image_path='img/plangs/'|add:model.implementation_language.svg_path %}
      {% if image_path|static_file_exists %}
      <img class="icon" src="{% static image_path %}" />
      {% else %}
      <p class="mb-1 lang">{{ model.implementation_language.language }}</p>
      {% endif %}
      {% endwith %}
    </div>
    <div class="col-4">
      <p class="mb-1 model">{{ model.name }}</p>
    </div>
    <div class="col-2">
      <p class="mb-1 author">{{ model.author.user.name }}</p>
    </div>
    <div class="col-2">
        <a href = "{{ model.repository }}"><p class="mb-1 repository">{{ model.repository|get_repo }}</p></a>    
    </div>
    <div class="col-3 badge-container">
      <span class="badge predict-date bg-primary rounded-pill">{{ model.created|date:"Y-m-d" }}</span>
      <span class="badge type bg-primary rounded-pill">{{ model.type }}</span>
    </div>
    <div class="col-10" style="padding-left: 5px;">
      <p class="mb-1 description">{{ model.description }}</p>
    </div>
    {% if user == model.author.user %}
     <a href="#"><i class="fa-solid fa-pencil" data-bs-toggle="modal" data-bs-target="#edit-model" style="color: #9a9996;" onclick="handleEditModel('{{model.id}}')"></i></a>
    {% endif %}
  </div>
  {% endfor %}
  <script src="{% static 'js/main/components/models-list.js' %}"></script>
</div>

<!-- TODO: Isolate this into its own templatetag -->
{% if user.is_authenticated %}
<div class="modal fade" id="edit-model" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="update-model-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="edit-model-label">Edit Model {{model.id}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="POST" id="editModelForm" action="{% url 'models' %}">
        {% csrf_token %}
        <input type="hidden" id="edit-model-id" name="model_id" value="{{ model_id }}">
        <div class="modal-body">
          <div class="row mb-3">
            <div class="col">
              <label for="model_name">Model Name:</label>
              <input type="text" id="edit-model-name" name="model_name" value="{{ model.name }}" class="form-control" maxlength="100" required>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col">
              <label for="model_description">Description:</label>
              <textarea rows="4" id="edit-model-desc" name="model_description" value="{{ model.description|default_if_none:"" }}" class="form-control" maxlength="500"></textarea>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col">
              <label for="model_repository">Github Repository:</label>
              <input type="text" id="edit-model-repo" name="model_repository" value="{{ model.repository }}" class="form-control" maxlength="150" required>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col">
              <label for="model_type">Type:</label>
              <input type="text" id="edit-model-type" name="model_type" value="{{ model.type }}" class="form-control" maxlength="100" required>
            </div>
            <div class="col">
              <label for="model_language">Implementation language:</label>
              <input type="text" id="edit-model-lang" name="model_language" value="{{ model.implementation_language.language }}" class="form-control" maxlength="100" required>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <a style="left:10px;position:absolute;" data-bs-toggle="modal" data-bs-target="#delete-model" name="delete_model" class="btn btn-outline-danger">Delete</a>
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" name="edit_model" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}


{% if user.is_authenticated %}
<div class="modal fade" id="delete-model" tabindex="-1" role="dialog" aria-labelledby="delete-model-label" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="delete-model-label"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="post" id="deleteModelForm" action="{% url 'models' %}">
        {% csrf_token %}
        <input type="hidden" id="delete-model-id" name="model_id" value="{{ model_id }}">
        <div class="modal-body">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" name="delete_model" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}

<link rel="stylesheet" type="text/css" href="{% static 'css/main/components/models-list.css' %}">
